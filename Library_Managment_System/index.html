<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Managment System</title>
<!-- CSS start -->
<style>
    body{
        margin: 0;
        padding: 0;
        font-family: Arial, Helvetica, sans-serif;
        line-height: 1.6;
    }
    /* navbar styling start */
    .navList{
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        color: #333;
       
    }
    .navbar{
         width: 100%;
        padding: 0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        background-color: rgb(122, 58, 58);
         border-radius: 10px;
         position: fixed;
         top: 0;
         left: 0;
         z-index: 1000;
    }
   .navLink{
    display: block;
    padding: 10px 20px;
    text-decoration: none;
    color: wheat;
    border-bottom: 2px solid lightcoral;
    text-align: center;
    transition: 0.3s ease;
    cursor: pointer;
   }
   .navLink:hover{
    background-color: rgb(87, 46, 46);

   }
  

   @media (max-width: 550px) {
   .navList{
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 20px;
    padding: 5px 0;
   }
   .navLink{
    background-color: transparent;
    border-bottom: none;
    padding: 10px 15px;
    color: wheat;
    cursor: pointer;
   }
    .navLink:hover{
    background-color: rgb(87, 46, 46);

   }
   /* navbar styling end */

/* Style for books card */


   }
   main{
   padding-top: 20px;
    max-width: 1200px;
    margin: 20px auto;
    background-color:white;
   
}
main h1{
    text-align: center;
    background-color: rgb(120, 119, 108);
    border-radius: 20px;
}
.card{
    display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));   
    gap: 40px;
  padding-top: 40px;
   align-items: stretch;
}

.book-card{
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    background-color: rgb(197, 145, 145);
    border-radius: 12px;
    box-shadow: 0 4px 10px rgb(191, 37, 37);
    overflow: hidden;
    align-items: center;
    justify-content: center;
    padding:15px;
    width: 100%;
    max-width: 300px;
    margin: auto;
    height: 100%;
     transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.book-card:hover{
    background-color: palevioletred;
}
#image{
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 15px;
}
.book-details{
    padding: 0 15px;
    box-sizing: border-box;
    width: 100%;
}

#title{
    font-size: 1.4rem;
    color: black;
    margin: 10px;
    font-style: italic;
    font-weight: bolder;
    margin-bottom: 5px;
}
#availability{
    font-size: 1rem;
    color: black;
    margin-bottom: 5px;
}

button {
  padding: 10px 15px;
  background-color: darkgreen;
  color: white;
  border: none;
  border-radius: 6px;
  margin: 10px;
  cursor: pointer;
}
#editFunction{display: flex;
    justify-content: center;
    align-items: center;
    padding: 10px;

}


#addBookBtn, #addMemberBtn{
    display: none;
    width: 10%;
    border-radius: 12px;
    text-align: center;
    justify-content: center;
    cursor: pointer;
}
#addBookBtn:hover, #addMemberBtn:hover{
background-color: peru;
}

#filterBy,#sortBy{
    padding: 10px 15px;
  background-color: rgb(205, 131, 70);
  color: rgb(176, 61, 61);
  border: none;
  border-radius: 6px;
  margin: 10px;
   text-align: center;
   color: rgb(143, 82, 82);
   font-weight: bolder;
}
#addBook{
    display: none;
}
</style>

<!-- Css END -->

</head>
<body>
    <!-- Navbar section start -->
    <header>
   <nav class="navbar">
    <ul class="navList">
        <li class="navItem"><a href="#" class="navLink" onclick="home()" >Home</a></li>
        <li class="navItem"><a href="#" class="navLink" onclick="displayBooks()" id="books">Books</a></li>
        <li class="navItem"><a href="#" class="navLink" onclick="displayMembers()">Members</a></li>
        <li class="navItem"><a href="#" class="navLink" onclick="contact()" >Contact</a></li>
    </ul>
   </nav>
   </header>
     <!-- Navbar section End -->
    
     <!-- Main section started and here bookk or member detial wil shown -->

     <main id="bookDisplay">
        <div id="addBook">
             <form onsubmit="addBooks(event)">

                <input type="text" name="" id="title" placeholder="Enter Title " required>
                <input type="text" name="" id="author" placeholder="Enter Author " required>
                <input type="text" name="" id="genre" placeholder="Genre" required>
                <input type="number" id="publishedYear" name="year" placeholder="YYYY" min="1900" max="2099" required>
                <select name="" id="available">
                    <option value="">available</option>
                    <option value="">Not available</option>
                </select>
                <button type="submit" id="addBookBtn">Submit</button>

            </form>




        </div>
       

  
         <div class="filter">
           
         </div>
         <div class="sortBy">
          
         </div>
    <div id="cardContainer" class="card"></div>

</main>
 <!-- Main section end here -->

     <!-- Footer section start -->
<footer></footer>
      <!-- footer section end -->

<!-- Java script code start from here -->
    <script>
        let editId = null;
        const books = 'https://moviedatabase-97ac8-default-rtdb.asia-southeast1.firebasedatabase.app/books'
    const members =  'https://moviedatabase-97ac8-default-rtdb.asia-southeast1.firebasedatabase.app/members'

// displaying books

async function displayBooks() {
      document.getElementById('addBook').style.display ="inline-block"

    
try{

    const response =await fetch('https://moviedatabase-97ac8-default-rtdb.asia-southeast1.firebasedatabase.app/books.json')
    let booksData = await response.json()

    document.getElementById('addBookBtn').style.display ="inline-block"
console.log(booksData)
    let bookContainer = document.getElementById('cardContainer');
    bookContainer.innerHTML=''
    bookContainer.className = 'card'
 
    Object.entries(booksData).forEach(([id,book])=>{
        if(!book)return
        let bookCard = document.createElement('div')
        bookCard.className = 'book-card';
        bookCard.innerHTML =`
         <img src="${book.imageUrl}" alt="${book.title}" id="image">
        <div class="book-details">
        <h3 id="title">${book.title} <p id="author">by ${book.author}</p> </h3>
        <p id="genre"><strong>Genre:</strong>${book.genre}(${book.publishedYear})</p>
        <p id="availability"><strong>Status:</strong>${book.available}</p>
        <button class="edit">Edit</button>
        <button onclick="deleteBook('${id}')">Delete Book</button>
          </div>
          
        `
        
         bookCard.querySelector('.edit').addEventListener('click',async()=>{
                   document.getElementById('title').value= book.title;
                    document.getElementById('author').value= book.author;
                    document.getElementById('genre').value= book.genre;
                    document.getElementById('publishedYear').value= book.publishedYear;
                    ocument.getElementById('available').value= book.available;

                  editId = id;
                  console.log(editId)
                })


        bookContainer.appendChild(bookCard)
        
    })
}catch(error)
{
    console.log("error")
}
    
}

// displaying members detials
async function displayMembers() {


    try {
        let res = await fetch(`${members}.json`)
        let data = await res.json();


        document.getElementById('addBookBtn').style.display ="inline-block"

     let bookContainer = document.getElementById('cardContainer');
    bookContainer.innerHTML=''
    bookContainer.className = 'card'

        Object.entries(data).forEach(([id,member])=>{
            if(member==null){
                return;
            }

            let bookCard = document.createElement('div')
        bookCard.className = 'book-card';
            
        bookCard.innerHTML =`
         <img src="${member.imageUrl}" alt="${member.name}" id="image">

        <div class="book-details">
        <h3 id="title">${member.name}</h3>
        <p id="genre">${member.membershipDate}</p>
        <p id="availability"><strong>Status:</strong>${member.active}</p>
        <button onclick="editMember()">Edit</button>
          <button onclick="deleteMember('${id}')">Delete Member</button>

          </div>
        `

        bookContainer.appendChild(bookCard)


            console.log(id)
        })


        
    } catch (error) {
        
    }
    
}

// home page
function home(){
    let homePage = document.getElementById('cardContainer')
    
    document.getElementById('addBookBtn').style.display ="none"
      homePage.innerHTML = `
        <h2>Hi, it's a Library Management website</h2>
        <p>To see the book list, please click on <strong>Books</strong> at the top of the page.</p>
        <p>To see the members' details, please click on <strong>Members</strong> at the top of the page.</p>
    `;

   

}


// contact us page

function contact() {
    const cardContainer = document.getElementById('cardContainer');
    cardContainer.className = '';
    cardContainer.innerHTML = `
        <h2>Contact Us</h2>
        <p>Email: princekumar7323870@gmail.com</p>
        <p>Phone: +91 6201618311</p>
        <p>Address: Hyderabad</p>
    `;

    document.getElementById('addBookBtn').style.display = "none";
}


//Delete book or member
async function deleteMember(memberId) {
    try{
    let res = await fetch(`${members}/${memberId}.json`,{
        method:'DELETE'
    })
    
    if(res.ok){
        alert("deleted member")
        displayMembers()
    }
}catch(error){
    console.log("error")
}

    
}

//delete book

async function deleteBook(bookId) {
    console.log(bookId)
    try{
    let res = await fetch(`${books}/${bookId}.json`,{
        method:'DELETE'
    })
    
    if(res.ok){
        alert("deleted books")
        displayBooks()
    }
}catch(error){
    console.log("error")
}

    
}

//filter forbooks


async function filtered(){

// genre author and availability
let res =await fetch(`${books}.json`)
let dataBooks =await res.json()
let booksArray = Object.values(dataBooks)
console.log(booksArray)

let filterBy = document.getElementById('filterBy').value
let  sortBy = document.getElementById('sortBy').value

// let filterData = booksArray.filter((book)=>{
//     if(filterBy=="genre")
// })



}
// sort function for books


// adding new book and ediiting existing here
async function addBooks(event) {
    event.preventDefault();


 const title = document.getElementById("title").value;
const author = document.getElementById("author").value;
    const genre = document.getElementById("genre").value;
const publishedYear = document.getElementById("publishedYear").value;
 const available = document.getElementById("available").value;

const book ={
    title,
    author,
    genre,
    publishedYear,
    available,
     imageUrl: `https://placehold.co/250x250/8B0000/FFFFFF?text=${encodeURIComponent(title)}`

}
let url= books
let method = 'POST'
if(editId){
    method='PATCH'
    url = `${books}/${editId}`

}

try{

    const res = await fetch(url+"json",{
 headers:{
        "Content-Type": "application/json"
    },
    body: JSON.stringify(book)
    })
   
displayBooks();
if(!res){
    throw new Error("Failed to submit")
}

form.reset()


}
catch(error){
    console.log(error)
}






console.log(book)

    
}

// document.getElementById('filterBy').addEventListener("change",filtered)
// document.getElementById('sortBy').addEventListener("change",filtered)

window.onload = function() {
    home();
}

    </script>
</body>
</html>